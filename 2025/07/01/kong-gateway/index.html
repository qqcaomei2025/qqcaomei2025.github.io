<!DOCTYPE html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="kong-gateway"><meta name="author" content="John Doe"><meta name="keywords" content=""><meta name="copyright" content="copyright.liscense_type"><title>Kong-Gateway</title><!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]><script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script><script src="https://cdn.bootcss.com/respond/1.4.2/respond.min.js"></script><![endif]--><link rel="icon" href="/compass/imgs/favicon.ico"><link rel="stylesheet" href="/compass/stylesheets/font-awesome.min.css"><script>var algoliaConfig = {"on":false}</script><link rel="stylesheet" href="/compass/stylesheets/screen.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="body-inner-wrapper"><header id="page-header"><nav id="nav"><div id="site-name">Hexo</div><i class="fa fa-bars fa-2x" id="nav-icon" aria-hidden="true"></i><div id="nav-expanded"><a class="nav-word-item" href="/">Home</a><a class="nav-word-item" href="/archives">Archives</a><a class="nav-word-item" href="/tags">Tags</a><a class="nav-word-item" href="/categories">Catogories</a></div><div id="nav-list"><ul><li><a class="nav-list-item" href="/">Home</a></li><li><a class="nav-list-item" href="/archives">Archives</a></li><li><a class="nav-list-item" href="/tags">Tags</a></li><li><a class="nav-list-item" href="/categories">Catogories</a></li></ul></div></nav><div id="banner-wrapper"><div id="banner-pagetype-dependent-info"><h1 id="post-title">Kong-Gateway</h1><span id="post-description"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-07-01</span><span id="word-count">The total word count - 723</span><span id="time-count">Estimated time of reading - 3 mins</span></div></div><a title="Back to Top"><i class="fa fa-arrow-up" id="to-Top" aria-hidden="true"></i></a><a title="Click to Toggle off"><i class="fa fa-toggle-on" id="toggle-on-Toc" aria-hidden="true"></i></a><a title="Click to Toggle on"><i class="fa fa-toggle-off" id="toggle-off-Toc" aria-hidden="true"></i></a></header><aside id="toc-column"><div id="toc-column-inner-wrapper"><div id="post-toc"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Install"><span class="toc-text">Install</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Kong-gateway"><span class="toc-text">使用Kong gateway</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%8A%E6%B8%B8service"><span class="toc-text">配置上游service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEJWT-%E8%AE%A4%E8%AF%81"><span class="toc-text">配置JWT 认证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEauth-%E6%9C%8D%E5%8A%A1%EF%BC%88%E4%B8%9A%E5%8A%A1%E8%87%AA%E5%B7%B1%E6%8F%90%E4%BE%9B%E7%9A%84auth-api%EF%BC%89"><span class="toc-text">配置auth 服务（业务自己提供的auth api）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAconsumer"><span class="toc-text">创建consumer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-u-0-%E4%BB%A5-root-%E8%BA%AB%E4%BB%BD%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8"><span class="toc-text">使用 -u 0 以 root 身份进入容器</span></a></div></div></aside><main id="main-content-column"><div id="main-content-wrapper"><div id="post-full-content"><h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><p>以docker 安装为例，参考<a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1565452?spm=5176.26934562.main.1.48ec4040pM7K6F">https://developer.aliyun.com/article/1565452?spm=5176.26934562.main.1.48ec4040pM7K6F</a> </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name kong-database \</span><br><span class="line">--network=kong-net \</span><br><span class="line">-p 5432:5432 \</span><br><span class="line">-e <span class="string">&quot;POSTGRES_USER=konguser&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;POSTGRES_DB=kong&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;POSTGRES_PASSWORD=kongpwd&quot;</span> \</span><br><span class="line">-v kong-volume:/var/lib/postgresql/data \</span><br><span class="line">postgres:15</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run --<span class="built_in">rm</span> --network=kong-net \</span><br><span class="line">-e <span class="string">&quot;KONG_DATABASE=postgres&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_PG_HOST=kong-database&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_PG_USER=konguser&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_PG_PASSWORD=kongpwd&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_PASSWORD=test&quot;</span> \</span><br><span class="line">kong/kong-gateway:3.4.1.1 kong migrations bootstrap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -d --name kong-gateway \</span><br><span class="line">--network=kong-net \</span><br><span class="line">-e <span class="string">&quot;KONG_DATABASE=postgres&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_PG_HOST=kong-database&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_PG_USER=konguser&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_PG_PASSWORD=kongpwd&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_PROXY_ACCESS_LOG=/dev/stdout&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_ADMIN_ACCESS_LOG=/dev/stdout&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_PROXY_ERROR_LOG=/dev/stderr&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_ADMIN_ERROR_LOG=/dev/stderr&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_ADMIN_LISTEN=0.0.0.0:8001&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;KONG_ADMIN_GUI_URL=http://localhost:8002&quot;</span> \</span><br><span class="line">-e KONG_LICENSE_DATA \</span><br><span class="line">-p 8000:8000 \</span><br><span class="line">-p 8443:8443 \</span><br><span class="line">-p 8001:8001 \</span><br><span class="line">-p 8444:8444 \</span><br><span class="line">-p 8002:8002 \</span><br><span class="line">-p 8445:8445 \</span><br><span class="line">-p 8003:8003 \</span><br><span class="line">-p 8004:8004 \</span><br><span class="line">kong/kong-gateway:3.4.1.1</span><br></pre></td></tr></table></figure>
<h3 id="使用Kong-gateway"><a href="#使用Kong-gateway" class="headerlink" title="使用Kong gateway"></a>使用Kong gateway</h3><h4 id="配置上游service"><a href="#配置上游service" class="headerlink" title="配置上游service"></a>配置上游service</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST --url <span class="string">&quot;http://localhost:8001/services&quot;</span> --data <span class="string">&quot;name=test&quot;</span> --data <span class="string">&quot;url=http://httpbin.org/anything&quot;</span></span><br><span class="line"></span><br><span class="line">curl -X POST --url <span class="string">&quot;http://localhost:8001/services/test/routes&quot;</span> --data <span class="string">&#x27;paths[]=/demo&#x27;</span></span><br></pre></td></tr></table></figure>
<p>访问 GET请求 <a target="_blank" rel="noopener" href="http://localhost:8000/demo">http://localhost:8000/demo</a> 可以获得跟<a target="_blank" rel="noopener" href="http://httpbin.org/anything">http://httpbin.org/anything</a> 相同的输出， 可以用浏览器，postman，或者直接curl</p>
<h4 id="配置JWT-认证"><a href="#配置JWT-认证" class="headerlink" title="配置JWT 认证"></a>配置JWT 认证</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:8001/services/test/plugins --data <span class="string">&quot;name=jwt&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置auth-服务（业务自己提供的auth-api）"><a href="#配置auth-服务（业务自己提供的auth-api）" class="headerlink" title="配置auth 服务（业务自己提供的auth api）"></a>配置auth 服务（业务自己提供的auth api）</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -i -X POST http://localhost:8001/services \</span><br><span class="line">  --data name=auth-service \</span><br><span class="line">  --data url=http://host.docker.internal:8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意，如果该auth服务起在本地，Kong在docker里面，需要确定能被kong访问到的地址。</span></span><br><span class="line"><span class="comment"># 创建认证路由</span></span><br><span class="line">curl -i -X POST http://localhost:8001/services/auth-service/routes \</span><br><span class="line">  --data paths[]=/auth</span><br></pre></td></tr></table></figure>

<p>业务认证代码例子，以golang为例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> JWT_SECRET = []<span class="type">byte</span>(<span class="string">&quot;my-secret-key&quot;</span>) <span class="comment">// 与consumer中的值保持一致</span></span><br><span class="line"><span class="keyword">var</span> JWT_ISSUER = <span class="string">&quot;my-app-key&quot;</span> <span class="comment">// 与consumer中的值保持一致</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Claims <span class="keyword">struct</span> &#123;</span><br><span class="line">	UserID <span class="type">uint</span> <span class="string">`json:&quot;user_id&quot;`</span></span><br><span class="line">	jwt.RegisteredClaims</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenerateToken</span><span class="params">(userID <span class="type">uint</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	claims := Claims&#123;</span><br><span class="line">		UserID: userID,</span><br><span class="line">		RegisteredClaims: jwt.RegisteredClaims&#123;</span><br><span class="line">			Issuer:    JWT_ISSUER,</span><br><span class="line">			ExpiresAt: jwt.NewNumericDate(time.Now().Add(<span class="number">24</span> * time.Hour)),</span><br><span class="line">			IssuedAt:  jwt.NewNumericDate(time.Now()),</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)</span><br><span class="line">	<span class="keyword">return</span> token.SignedString(JWT_SECRET)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可以添加&quot;sub&quot;: &quot;用户唯一标识&quot;, 用user id之类的标识</span></span><br></pre></td></tr></table></figure>
<h4 id="创建consumer"><a href="#创建consumer" class="headerlink" title="创建consumer"></a>创建consumer</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -i -X POST http://localhost:8001/consumers \</span><br><span class="line">  --data username=web-client</span><br><span class="line"></span><br><span class="line">curl -i -X POST http://localhost:8001/consumers/web-client/jwt \</span><br><span class="line">  -F <span class="string">&quot;key=my-app-key&quot;</span> \</span><br><span class="line">  -F <span class="string">&quot;secret=my-secret-key&quot;</span> \</span><br><span class="line">  -F <span class="string">&quot;algorithm=HS256&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># key=my-app-key 需要跟业务自己提供的ISSUE 保持一致</span></span><br><span class="line">  <span class="comment"># secret=my-secret-key 需要跟业务自己提供的 Sign secret报纸一致</span></span><br><span class="line">  <span class="comment"># algorithm=HS256 需要跟签名算法保持一致</span></span><br></pre></td></tr></table></figure>



<p>遇到的问题</p>
<h1 id="使用-u-0-以-root-身份进入容器"><a href="#使用-u-0-以-root-身份进入容器" class="headerlink" title="使用 -u 0 以 root 身份进入容器"></a>使用 -u 0 以 root 身份进入容器</h1><p>docker exec -u 0 -it kong-container-name sh</p>
</div></div></main><div id="pagination-wrapper"><a id="page-next" href="/2025/06/30/logistics/">logistics management system <i class="fa fa-chevron-right"></i></a></div><footer id="page-footer"><div id="footer-wrapper"><div id="blog-meta">&copy;2017-2025 By John Doe | Theme - <a id='theme-name' target="_blank" rel="noopener" href="https://github.com/huan555/lemon-lime"> Lemon-Lime</a> | Power By <a id='theme-powered-by' href=http://hexo.io> Hexo</a></div><div id="viewed-record"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span></span></div><div id="copyright-wrapper"><i class="fa fa-cc" aria-hidden="true"></i><div id="copyright">Except where otherwise noted, content on this blog is licensed under <a rel="license" href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>.</div></div><div id="contact-me"><div id="rss"><a href="/atom.xml" type="application/atom+xml" rel="alternate" target="_blank"><i class="fa fa-rss" aria-hidden="true"></i></a></div><span id="github"><a target="_blank" rel="noopener" href="https://github.com/yourUserName"><i class="fa fa-github" aria-hidden="true"></i></a></span></div></div></footer><script src="/compass/js/blog.js"></script></div></body>